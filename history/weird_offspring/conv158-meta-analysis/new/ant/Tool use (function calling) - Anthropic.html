
<div ><p>Claude is capable of interacting with external client-side tools and functions, allowing you to equip Claude with your own custom tools to perform a wider variety of tasks.</p>
<div >form</a>.</p></div></div>
<p>Here’s an example of how to provide tools to Claude using the Messages API:</p>
<!-- -->
<hr/>
<h2 >How tool use works</span></h2>
<p>Integrate external tools with Claude in these steps:</p>
<div role="list" >Provide Claude with tools and a user prompt</p><div><ul>
<li>Define tools with names, descriptions, and input schemas in your API request.</li>
<li>Include a user prompt that might require these tools, e.g., “What’s the weather in San Francisco?”</li>
</ul></div></div></div><div role="listitem" >Claude decides to use a tool</p><div><ul>
<li>Claude assesses if any tools can help with the user’s query.</li>
<li>If yes, Claude constructs a properly formatted tool use request.</li>
<li>The API response has a <code>stop_reason</code> of <code>tool_use</code>, signaling Claude’s intent.</li>
</ul></div></div></div><div role="listitem" >Extract tool input, run code, and return results</p><div><ul>
<li>On your end, extract the tool name and input from Claude’s request.</li>
<li>Execute the actual tool code client-side.</li>
<li>Continue the conversation with a new <code>user</code> message containing a <code>tool_result</code> content block.</li>
</ul></div></div></div><div role="listitem" >Claude uses tool result to formulate a response</p><div><ul>
<li>Claude analyzes the tool results to craft its final response to the original user prompt.</li>
</ul></div></div></div></div>
<p>Note: Steps 3 and 4 are optional. For some workflows, Claude’s tool use request (step 2) might be all you need, without sending results back to Claude.</p>
<div ><p><strong>All tools are user-provided</strong></p><p>It’s important to note that Claude does not have access to any built-in server-side tools. All tools must be explicitly provided by you, the user, in each API request. This gives you full control and flexibility over the tools Claude can use.</p></div></div>
<hr/>
<h2 >How to implement tool use</span></h2>
<h3 >Choosing a model</span></h3>
<p>Generally, use Claude 3 Opus for complex tools and ambiguous queries; it handles multiple tools better and seeks clarification when needed.</p>
<p>Use Haiku for straightforward tools, but note it may infer missing parameters.</p>
<h3 >Specifying tools</span></h3>
<p>Tools are specified in the <code>tools</code> top-level parameter of the API request. Each tool definition includes:</p>
<table><thead><tr><th align="left">Parameter</th><th align="left">Description</th></tr></thead><tbody><tr><td align="left"><code>name</code></td><td align="left">The name of the tool. Must match the regex <code>^[a-zA-Z0-9_-]{1,64}$</code>.</td></tr><tr><td align="left"><code>description</code></td><td align="left">A detailed plaintext description of what the tool does, when it should be used, and how it behaves.</td></tr><tr><td align="left"><code>input_schema</code></td><td align="left">A <a href="https://json-schema.org/" target="_blank" rel="noreferrer">JSON Schema</a> object defining the expected parameters for the tool.</td></tr></tbody></table>
<div><button >{</span>
  <span >,</span>
  <span >,</span>
  <span >{</span>
    <span >,</span>
    <span >{</span>
      <span >{</span>
        <span >,</span>
        <span >&quot;The city and state, e.g. San Francisco, CA&quot;</span>
      <span >,</span>
      <span >{</span>
        <span >,</span>
        <span >,</span>
        <span >&quot;The unit of temperature, either &#x27;celsius&#x27; or &#x27;fahrenheit&#x27;&quot;</span>
      <span >}</span>
    <span >,</span>
    <span >]</span>
  <span >}</span>
<span >}</span>
</code></pre></div></div><p>This tool, named <code>get_weather</code>, expects an input object with a required <code>location</code> string and an optional <code>unit</code> string that must be either “celsius” or “fahrenheit”.</p></div></div>
<h4 >Best practices for tool definitions</span></h4>
<p>To get the best performance out of Claude when using tools, follow these guidelines:</p>
<ul>
<li><strong>Provide extremely detailed descriptions.</strong> This is by far the most important factor in tool performance. Your descriptions should explain every detail about the tool, including:<!-- -->
<ul>
<li>What the tool does</li>
<li>When it should be used (and when it shouldn’t)</li>
<li>What each parameter means and how it affects the tool’s behavior</li>
<li>Any important caveats or limitations, such as what information the tool does not return if the tool name is unclear. The more context you can give Claude about your tools, the better it will be at deciding when and how to use them. Aim for at least 3-4 sentences per tool description, more if the tool is complex.</li>
</ul>
</li>
<li><strong>Prioritize descriptions over examples.</strong> While you can include examples of how to use a tool in its description or in the accompanying prompt, this is less important than having a clear and comprehensive explanation of the tool’s purpose and parameters. Only add examples after you’ve fully fleshed out the description.</li>
</ul>
<div >{</span>
  <span >,</span>
  <span >,</span>
  <span >{</span>
    <span >,</span>
    <span >{</span>
      <span >{</span>
        <span >,</span>
        <span >&quot;The stock ticker symbol, e.g. AAPL for Apple Inc.&quot;</span>
      <span >}</span>
    <span >,</span>
    <span >]</span>
  <span >}</span>
<span >}</span>
</code></pre></div></div></div></div><div><button >{</span>
  <span >,</span>
  <span >,</span>
  <span >{</span>
    <span >,</span>
    <span >{</span>
      <span >{</span>
        <span >&quot;string&quot;</span>
      <span >}</span>
    <span >,</span>
    <span >]</span>
  <span >}</span>
<span >}</span>
</code></pre></div></div></div></div></div>
<p>The good description clearly explains what the tool does, when to use it, what data it returns, and what the <code>ticker</code> parameter means. The poor description is too brief and leaves Claude with many open questions about the tool’s behavior and usage.</p>
<h3 >Controlling Claude’s output</span></h3>
<h4 >Forcing tool use</span></h4>
<p>In some cases, you may want Claude to use a specific tool to answer the user’s question, even if Claude thinks it can provide an answer without using a tool. You can do this by specifying the tool in the <code>tool_choice</code> field like so:</p>
<div ><pre><code>tool_choice = {&quot;type&quot;: &quot;tool&quot;, &quot;name&quot;: &quot;get_weather&quot;}
</code></pre></div></div>
<p>When working with the tool_choice parameter, we have three possible options:</p>
<ul>
<li><code>auto</code> allows Claude to decide whether to call any provided tools or not. This is the default value.</li>
<li><code>any</code> tells Claude that it must use one of the provided tools, but doesn’t force a particular tool.</li>
<li><code>tool</code> allows us to force Claude to always use a particular tool.</li>
</ul>
<p>This diagram illustrates how each option works:</p>
<div><div ></div></div></div>
<p>Note that when you have <code>tool_choice</code> as <code>any</code> or <code>tool</code>, we will prefill the assistant message to force a tool to be used. This means that the models will not emit a chain-of-thought <code>text</code> content block before <code>tool_use</code> content blocks, even if explicitly asked to do so.</p>
<p>Our testing has shown that this should not reduce performance. If you would like to keep chain-of-thought (particularly with Opus) while still requesting that the model use a specific tool, you can use <code>{&quot;type&quot;: &quot;auto&quot;}</code> for <code>tool_choice</code> (the default) and add explicit instructions in a <code>user</code> message. For example: <code>What&#x27;s the weather like in London? Use the get_weather tool in your response.</code></p>
<h4 >JSON output</span></h4>
<p>Tools do not necessarily need to be client-side functions — you can use tools anytime you want the model to return JSON output that follows a provided schema. For example, you might use a <code>record_summary</code> tool with a particular schema. See <a href="/en/docs/build-with-claude/tool-use#json-mode">tool use examples</a> for a full working example.</p>
<h4 >Chain of thought</span></h4>
<p>When using tools, Claude will often show its “chain of thought”, i.e. the step-by-step reasoning it uses to break down the problem and decide which tools to use. The Claude 3 Opus model will do this if <code>tool_choice</code> is set to <code>auto</code> (this is the default value, see <a href="/_sites/docs.anthropic.com/en/docs/build-with-claude/tool-use#forcing-tool-use">Forcing tool use</a>), and Sonnet and Haiku can be prompted into doing it.</p>
<p>For example, given the prompt “What’s the weather like in San Francisco right now, and what time is it there?”, Claude might respond with:</p>
<div >{</span>
  <span >,</span>
  <span >[</span>
    <span >{</span>
      <span >,</span>
      <span >&quot;&lt;thinking&gt;To answer this question, I will: 1. Use the get_weather tool to get the current weather in San Francisco. 2. Use the get_time tool to get the current time in the America/Los_Angeles timezone, which covers San Francisco, CA.&lt;/thinking&gt;&quot;</span>
    <span >,</span>
    <span >{</span>
      <span >,</span>
      <span >,</span>
      <span >,</span>
      <span >}</span>
    <span >}</span>
  <span >]</span>
<span >}</span>
</code></pre></div></div>
<p>This chain of thought gives insight into Claude’s reasoning process and can help you debug unexpected behavior.</p>
<p>With the Claude 3 Sonnet model, chain of thought is less common by default, but you can prompt Claude to show its reasoning by adding something like <code>&quot;Before answering, explain your reasoning step-by-step in tags.&quot;</code> to the user message or system prompt.</p>
<p>It’s important to note that while the <code>&lt;thinking&gt;</code> tags are a common convention Claude uses to denote its chain of thought, the exact format (such as what this XML tag is named) may change over time. Your code should treat the chain of thought like any other assistant-generated text, and not rely on the presence or specific formatting of the <code>&lt;thinking&gt;</code> tags.</p>
<h3 >Handling tool use and tool result content blocks</span></h3>
<p>When Claude decides to use one of the tools you’ve provided, it will return a response with a <code>stop_reason</code> of <code>tool_use</code> and one or more <code>tool_use</code> content blocks in the API response that include:</p>
<ul>
<li><code>id</code>: A unique identifier for this particular tool use block. This will be used to match up the tool results later.</li>
<li><code>name</code>: The name of the tool being used.</li>
<li><code>input</code>: An object containing the input being passed to the tool, conforming to the tool’s <code>input_schema</code>.</li>
</ul>
<div><button >{</span>
  <span >,</span>
  <span >,</span>
  <span >,</span>
  <span >,</span>
  <span >[</span>
    <span >{</span>
      <span >,</span>
      <span >&quot;&lt;thinking&gt;I need to use the get_weather, and the user wants SF, which is likely San Francisco, CA.&lt;/thinking&gt;&quot;</span>
    <span >,</span>
    <span >{</span>
      <span >,</span>
      <span >,</span>
      <span >,</span>
      <span >}</span>
    <span >}</span>
  <span >]</span>
<span >}</span>
</code></pre></div></div></div></div>
<p>When you receive a tool use response, you should:</p>
<ol>
<li>Extract the <code>name</code>, <code>id</code>, and <code>input</code> from the <code>tool_use</code> block.</li>
<li>Run the actual tool in your codebase corresponding to that tool name, passing in the tool <code>input</code>.</li>
<li>[optional] Continue the conversation by sending a new message with the <code>role</code> of <code>user</code>, and a <code>content</code> block containing the <code>tool_result</code> type and the following information:<!-- -->
<ul>
<li><code>tool_use_id</code>: The <code>id</code> of the tool use request this is a result for.</li>
<li><code>content</code>: The result of the tool, as a string (e.g. <code>&quot;content&quot;: &quot;15 degrees&quot;</code>) or list of nested content blocks (e.g. <code>&quot;content&quot;: [{&quot;type&quot;: &quot;text&quot;, &quot;text&quot;: &quot;15 degrees&quot;}]</code>). These content blocks can use the <code>text</code> or <code>image</code> types.</li>
<li><code>is_error</code> (optional): Set to <code>true</code> if the tool execution resulted in an error.</li>
</ul>
</li>
</ol>
<div >{</span>
  <span >,</span>
  <span >[</span>
    <span >{</span>
      <span >,</span>
      <span >,</span>
      <span >&quot;15 degrees&quot;</span>
    <span >}</span>
  <span >]</span>
<span >}</span>
</code></pre></div></div></div></div><div><button >{</span>
  <span >,</span>
  <span >[</span>
    <span >{</span>
      <span >,</span>
      <span >,</span>
      <span >[</span>
        <span >,</span>
        <span >{</span>
          <span >,</span>
          <span >{</span>
            <span >,</span>
            <span >,</span>
            <span >,</span>
          <span >}</span>
        <span >}</span>
      <span >]</span>
    <span >}</span>
  <span >]</span>
<span >}</span>
</code></pre></div></div></div></div><div><button >{</span>
  <span >,</span>
  <span >[</span>
    <span >{</span>
      <span >,</span>
      <span >,</span>
    <span >}</span>
  <span >]</span>
<span >}</span>
</code></pre></div></div></div></div></div>
<p>After receiving the tool result, Claude will use that information to continue generating a response to the original user prompt.</p>
<div ><p><strong>Differences from other APIs</strong></p><p>Unlike APIs that separate tool use or use special roles like <code>tool</code> or <code>function</code>, Anthropic’s API integrates tools directly into the <code>user</code> and <code>assistant</code> message structure.</p><p>Messages contain arrays of <code>text</code>, <code>image</code>, <code>tool_use</code>, and <code>tool_result</code> blocks. <code>user</code> messages include client-side content and <code>tool_result</code>, while <code>assistant</code> messages contain AI-generated content and <code>tool_use</code>.</p></div></div>
<h3 >Troubleshooting errors</span></h3>
<p>There are a few different types of errors that can occur when using tools with Claude:</p>
<div >{</span>
  <span >,</span>
  <span >[</span>
    <span >{</span>
      <span >,</span>
      <span >,</span>
      <span >,</span>
      <span >true</span>
    <span >}</span>
  <span >]</span>
<span >}</span>
</code></pre></div></div><p>Claude will then incorporate this error into its response to the user, e.g. “I’m sorry, I was unable to retrieve the current weather because the weather service API is not available. Please try again later.”</p></div></div><div><button >{</span>
  <span >,</span>
  <span >[</span>
    <span >{</span>
      <span >,</span>
      <span >,</span>
      <span >,</span>
      <span >true</span>
    <span >}</span>
  <span >]</span>
<span >}</span>
</code></pre></div></div><p>If a tool request is invalid or missing parameters, Claude will retry 2-3 times with corrections before apologizing to the user.</p></div></div><div><button ><p>To prevent Claude from reflecting on search quality with &lt;search_quality_reflection&gt; tags, add “Do not reflect on the quality of the returned search results in your response” to your prompt.</p></div></div></div>
<hr/>
<h2 >Tool use examples</span></h2>
<p>Here are a few code examples demonstrating various tool use patterns and techniques. For brevity’s sake, the tools are simple tools, and the tool descriptions are shorter than would be ideal to ensure best performance.</p>
<div >{</span>
  <span >,</span>
  <span >,</span>
  <span >,</span>
  <span >,</span>
  <span >[</span>
    <span >{</span>
      <span >,</span>
      <span >&quot;&lt;thinking&gt;I need to call the get_weather function, and the user wants SF, which is likely San Francisco, CA.&lt;/thinking&gt;&quot;</span>
    <span >,</span>
    <span >{</span>
      <span >,</span>
      <span >,</span> 
      <span >,</span>
      <span >}</span>
    <span >}</span>
  <span >]</span>
<span >}</span>
</code></pre></div></div><p>You would then need to execute the <code>get_weather</code> function with the provided input, and return the result in a new <code>user</code> message:</p><p>This will print Claude’s final response, incorporating the weather data:</p><div >{</span>
  <span >,</span>
  <span >,</span>
  <span >,</span>
  <span >,</span>
  <span >[</span>
    <span >{</span>
      <span >,</span>
      <span >&quot;The current weather in San Francisco is 15 degrees Celsius (59 degrees Fahrenheit). It&#x27;s a cool day in the city by the bay!&quot;</span>
    <span >}</span>
  <span >]</span>
<span >}</span>
</code></pre></div></div></div></div><div><button >{</span>
  <span >,</span>
  <span >,</span>
  <span >,</span> 
  <span >}</span>
<span >}</span>
</code></pre></div></div><p>This behavior is not guaranteed, especially for more ambiguous prompts and for models less intelligent than Claude 3 Opus. If Claude 3 Opus doesn’t have enough context to fill in the required parameters, it is far more likely respond with a clarifying question instead of making a tool call.</p></div></div><div><button ><p>Some tasks may require calling multiple tools in sequence, using the output of one tool as the input to another. In such a case, Claude will call one tool at a time. If prompted to call the tools all at once, Claude is likely to guess parameters for tools further downstream if they are dependent on tool results for tools further upstream.</p><p>Here’s an example of using a <code>get_location</code> tool to get the user’s location, then passing that location to the <code>get_weather</code> tool:</p><p>In this case, Claude would first call the <code>get_location</code> tool to get the user’s location. After you return the location in a <code>tool_result</code>, Claude would then call <code>get_weather</code> with that location to get the final answer.</p><p>The full conversation might look like:</p><table><thead><tr><th>Role</th><th>Content</th></tr></thead><tbody><tr><td>User</td><td>What’s the weather like where I am?</td></tr><tr><td>Assistant</td><td>&lt;thinking&gt;To answer this, I first need to determine the user’s location using the get_location tool. Then I can pass that location to the get_weather tool to find the current weather there.&lt;/thinking&gt;[Tool use for get_location]</td></tr><tr><td>User</td><td>[Tool result for get_location with matching id and result of San Francisco, CA]</td></tr><tr><td>Assistant</td><td>[Tool use for get_weather with the following input]{ “location”: “San Francisco, CA”, “unit”: “fahrenheit” }</td></tr><tr><td>User</td><td>[Tool result for get_weather with matching id and result of “59°F (15°C), mostly cloudy”]</td></tr><tr><td>Assistant</td><td>Based on your current location in San Francisco, CA, the weather right now is 59°F (15°C) and mostly cloudy. It’s a fairly cool and overcast day in the city. You may want to bring a light jacket if you’re heading outside.</td></tr></tbody></table><p>This example demonstrates how Claude can chain together multiple tool calls to answer a question that requires gathering data from different sources. The key steps are:</p><ol>
<li>Claude first realizes it needs the user’s location to answer the weather question, so it calls the <code>get_location</code> tool.</li>
<li>The user (i.e. the client code) executes the actual <code>get_location</code> function and returns the result “San Francisco, CA” in a <code>tool_result</code> block.</li>
<li>With the location now known, Claude proceeds to call the <code>get_weather</code> tool, passing in “San Francisco, CA” as the <code>location</code> parameter (as well as a guessed <code>unit</code> parameter, as <code>unit</code> is not a required parameter).</li>
<li>The user again executes the actual <code>get_weather</code> function with the provided arguments and returns the weather data in another <code>tool_result</code> block.</li>
<li>Finally, Claude incorporates the weather data into a natural language response to the original question.</li>
</ol></div></div><div><button><div id="chain-of-thought-tool-use" ></div><div ><p>You can use tools to get Claude produce JSON output that follows a schema, even if you don’t have any intention of running that output through a tool or function.</p><p>When using tools in this way:</p><ul>
<li>You usually want to provide a <strong>single</strong> tool</li>
<li>You should set <code>tool_choice</code> (see <a href="/en/docs/tool-use#forcing-tool-use">Forcing tool use</a>) to instruct the model to explicitly use that tool</li>
<li>Remember that the model will pass the <code>input</code> to the tool, so the name of the tool and description should be from the model’s perspective.</li>
</ul><p>The following uses a <code>record_summary</code> tool to describe an image following a particular format.</p></div></div></div>
<hr/>
<h2 >Pricing</span></h2>
<p>Tool use requests are priced the same as any other Claude API request, based on the total number of input tokens sent to the model (including in the <code>tools</code> parameter) and the number of output tokens generated.”</p>
<p>The additional tokens from tool use come from:</p>
<ul>
<li>The <code>tools</code> parameter in API requests (tool names, descriptions, and schemas)</li>
<li><code>tool_use</code> content blocks in API requests and responses</li>
<li><code>tool_result</code> content blocks in API requests</li>
</ul>
<p>When you use <code>tools</code>, we also automatically include a special system prompt for the model which enables tool use. The number of tool use tokens required for each model are listed below (excluding the additional tokens listed above):</p>
<table><thead><tr><th>Model</th><th>Tool choice</th><th>Tool use system prompt token count</th></tr></thead><tbody><tr><td>Claude 3.5 Sonnet</td><td><code>auto</code><hr />340 tokens</td></tr></tbody></table>
<p>These token counts are added to your normal input and output tokens to calculate the total cost of a request. Refer to our <a href="/en/docs/models-overview#model-comparison">models overview table</a> for current per-model prices.</p>
<p>When you send a tool use prompt, just like any other API request, the response will output both input and output token counts as part of the reported <code>usage</code> metrics.</p>
<hr/>
